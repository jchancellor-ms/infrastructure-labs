apiVersion: windows.k8s.io/v1
kind: GMSACredentialSpec
metadata:
  name: ${gmsa_account_name} #This is an arbitrary name but it will be used as a reference
credspec:
  ActiveDirectoryConfig:
    GroupManagedServiceAccounts:
    - Name: ${gmsa_account_name}   #Username of the GMSA account
      Scope: ${active_directory_netbios_name}  #NETBIOS Domain Name
    - Name: ${gmsa_account_name}   #Username of the GMSA account
      Scope: ${active_directory_domain} #DNS Domain Name
    HostAccountConfig:
      PluginGuid: {GDMA0342-266A-4D1P-831J-20990E82944F} #GUID of the key vault plugin
      PluginInput: ObjectId="${user_assigned_mi}";SecretUri="${secret_url}"
      PortableCcgVersion: 1
  CmsPlugins:
  - ActiveDirectory
  DomainJoinConfig:
    DnsName: ${active_directory_domain}  #DNS Domain Name
    DnsTreeName: ${active_directory_domain} #DNS Domain Name Root
    Guid: ${domain_guid}  #GUID of Domain
    MachineAccountName: ${gmsa_account_name} #Username of the GMSA account
    NetBiosName: ${active_directory_netbios_name}   #NETBIOS Domain Name
    Sid: ${domain_sid} #SID of Domain